<article class="flex flex-col items-center bg-gray-100 p-4 rounded-lg shadow-lg w-80">
  <h2 class="text-lg font-bold mb-3">{{ columnTitle }}</h2>
  <ul cdkDropList [id]="id" [cdkDropListData]="columnTasks" [cdkDropListConnectedTo]="connectedTo"
    (cdkDropListDropped)="onMoveColumnTask($event)" class="w-full space-y-6">
    @if (columnTasks.length === 0) {
    <li class="text-gray-400 text-center italic" i18n>Arraste tarefas para cá</li>
    }
    @for (item of columnTasks; track $index) {
    <li cdkDrag [@fadeInOut] class="p-2 rounded-lg shadow-md cursor-move list-none relative" [ngClass]="{
        'bg-blue-200': colorTask === 'blue',
        'bg-yellow-200': colorTask === 'yellow',
        'bg-green-200': colorTask === 'green'
      }">

      <button (click)="onDeleteTask(item.id)" class="absolute -top-3 -right-3 " aria-label="Excluir tarefa"
        i18n-aria-label>
        <fa-icon [icon]="icons.trash"
          class=" rounded-full px-2 text-red-500 py-1.5 shadow-lg transition-transform transform hover:scale-110 active:scale-95"
          [ngClass]="{
        'bg-blue-200': colorTask === 'blue',
        'bg-yellow-200': colorTask === 'yellow',
        'bg-green-200': colorTask === 'green'
      }"></fa-icon>
      </button>
      <div class="flex flex-col items-start space-y-2">
        <h3 class="font-medium text-lg">{{ item.title }}</h3>
        <p class="text-sm text-gray-600">{{ item.description }}</p>
        @if(item.image){
        <img [src]="item.image" alt="Tarefa" i18n-alt class="w-full h-32 object-cover rounded-lg" />
        }
      </div>
    </li>
    }
  </ul>
  <button (click)="toggleForm()" i18n class="group mt-5  transition-colors duration-300 ease-out w-full py-3 flex items-center justify-center rounded-lg shadow-md gap-3 text-white font-medium hover:shadow-lg focus:outline-none focus:ring-2
  " [ngClass]="{
    'bg-blue-500 hover:bg-blue-600 focus:ring-blue-300': colorTask === 'blue',
    'bg-yellow-500 hover:bg-yellow-600 focus:ring-yellow-300': colorTask === 'yellow',
    'bg-green-500 hover:bg-green-600 focus:ring-green-300': colorTask === 'green'
  }">

    <fa-icon [icon]="icons.plus" class="bg-white w-6 h-6 rounded-full transition-colors duration-300 ease-in-out"
      [ngClass]="{
        ' text-blue-500 group-hover:bg-blue-100': colorTask === 'blue',
        ' text-yellow-500 group-hover:bg-yellow-100 ': colorTask === 'yellow',
        ' text-green-500 group-hover:bg-green-100 ': colorTask === 'green'
      }" />
    <span>Criar Tarefa</span>
  </button>

  @if (showForm) {
  <form [formGroup]="taskForm" (ngSubmit)="createTask()" class="mt-3 flex flex-col gap-3 w-full">
    <input formControlName="title" placeholder="Título" i18n-placeholder
      class="border p-2 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-opacity-50" [ngClass]="{
        'focus:ring-blue-400': colorTask === 'blue',
        'focus:ring-yellow-400': colorTask === 'yellow',
        'focus:ring-green-400': colorTask === 'green'
      }" required />
    @if (taskForm.get('title')?.invalid && (taskForm.get('title')?.touched ||
    taskForm.get('title')?.dirty)) {
    <p class="text-red-500 text-sm">
      @if (taskForm.get('title')?.errors?.['required']) {
      <span i18n>Título é obrigatório.</span>
      <br>}
      @if (taskForm.get('title')?.errors?.['minlength']) {
      <span i18n>
        O título deve ter pelo menos 3 caracteres.
      </span>
      <br>}
      @if (taskForm.get('title')?.errors?.['maxlength']) {
      <span i18n>
        O título deve ter no máximo 100 caracteres.
      </span>
      <br>}
    </p>
    }
    <textarea formControlName="description" placeholder="Descrição" i18n-placeholder
      class="border p-2 rounded-lg shadow-sm resize-none h-24 focus:outline-none focus:ring-2 focus:ring-opacity-50"
      [ngClass]="{
        'focus:ring-blue-400': colorTask === 'blue',
        'focus:ring-yellow-400': colorTask === 'yellow',
        'focus:ring-green-400': colorTask === 'green'
      }" required></textarea>
    @if (taskForm.get('description')?.invalid &&
    (taskForm.get('description')?.touched ||
    taskForm.get('description')?.dirty)) {
    <p class="text-red-500 text-sm">
      @if (taskForm.get('description')?.errors?.['required']) {
      <span i18n>
        Descrição é obrigatória.
      </span><br>}
      @if (taskForm.get('description')?.errors?.['minlength']) {
      <span i18n>
        A descrição deve ter pelo menos 10 caracteres.
      </span> <br>}
      @if (taskForm.get('description')?.errors?.['maxlength']) {
      <span i18n>
        A descrição deve ter no máximo 500 caracteres.
      </span> <br>}
    </p>
    }

    <input formControlName="image" placeholder="Imagem URL" i18n-placeholder
      class="border p-2 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-opacity-50" [ngClass]="{
        'focus:ring-blue-400': colorTask === 'blue',
        'focus:ring-yellow-400': colorTask === 'yellow',
        'focus:ring-green-400': colorTask === 'green'
      }" />
    @if (taskForm.get('image')?.invalid && (taskForm.get('image')?.touched ||
    taskForm.get('image')?.dirty)) {
    <p class="text-red-500 text-sm">
      @if (taskForm.get('image')?.errors?.['pattern']) {
      <span i18n>
        URL da imagem é inválida.
      </span>}
    </p>
    }
    <div class="flex items-center gap-2">
      <button type="submit" [disabled]="taskForm.invalid" i18n
        class=" w-[85%] py-2 rounded-lg shadow-md text-white font-medium transition-colors duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
        [ngClass]="{
          'bg-blue-500 hover:bg-blue-600 focus:ring-blue-300': colorTask === 'blue',
          'bg-yellow-500 hover:bg-yellow-600 focus:ring-yellow-300': colorTask === 'yellow',
          'bg-green-500 hover:bg-green-600 focus:ring-green-300': colorTask === 'green'
        }">
        Adicionar Tarefa
      </button>
      <button type="button" class="w-[10%]" (click)="showForm = false">
        <abbr title="fechar formulário">
          <fa-icon [icon]="icons.xmark" class="bg-white w-6 h-6 rounded-full transition-colors duration-300 ease-in-out"
            [ngClass]="{
          ' text-blue-500 group-hover:bg-blue-100': colorTask === 'blue',
          ' text-yellow-500 group-hover:bg-yellow-100 ': colorTask === 'yellow',
          ' text-green-500 group-hover:bg-green-100 ': colorTask === 'green'
                }" />
        </abbr>
      </button>
    </div>
  </form>
  }
  @if (errorMessage) {
  <app-alert [message]="errorMessage" [type]="'error'" [duration]="5000">
  </app-alert>
  }
  @if (successMessage) {
  <app-alert [message]="successMessage" [type]="'success'" [duration]="5000"></app-alert>
  }
</article>
